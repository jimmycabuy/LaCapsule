{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Camera } from 'expo-camera';\nimport { Button, Overlay, Input } from 'react-native-elements';\nimport IonIcon from \"@expo/vector-icons/Ionicons\";\nimport { useIsFocused } from '@react-navigation/native';\nimport { connect } from 'react-redux';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction SnapScreen(props) {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      hasPermission = _useState2[0],\n      setHasPermission = _useState2[1];\n\n  var _useState3 = useState(Camera.Constants.Type.back),\n      _useState4 = _slicedToArray(_useState3, 2),\n      type = _useState4[0],\n      setType = _useState4[1];\n\n  var _useState5 = useState(Camera.Constants.FlashMode.off),\n      _useState6 = _slicedToArray(_useState5, 2),\n      flash = _useState6[0],\n      setFlash = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isVisible = _useState8[0],\n      setIsVisible = _useState8[1];\n\n  var cameraRef = useRef(null);\n  var isFocused = useIsFocused();\n  useEffect(function () {\n    (function _callee() {\n      var _await$Camera$request, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestCameraPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context.sent;\n              status = _await$Camera$request.status;\n              setHasPermission(status === 'granted');\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n  var cameraDisplay;\n\n  if (hasPermission && isFocused) {\n    cameraDisplay = _jsxs(Camera, {\n      type: type,\n      flashMode: flash,\n      style: {\n        flex: 1\n      },\n      ref: function ref(_ref) {\n        return cameraRef = _ref;\n      },\n      children: [_jsxs(View, {\n        style: {\n          flex: 1,\n          flexDirection: 'row',\n          justifyContent: 'center',\n          alignItems: 'flex-end'\n        },\n        children: [_jsxs(TouchableOpacity, {\n          style: {\n            alignItems: \"center\",\n            paddingRight: 10,\n            paddingBottom: 10\n          },\n          onPress: function onPress() {\n            setType(type === Camera.Constants.Type.back ? Camera.Constants.Type.front : Camera.Constants.Type.back);\n          },\n          children: [_jsx(IonIcon, {\n            name: \"camera-reverse\",\n            size: 30,\n            color: \"white\"\n          }), _jsx(Text, {\n            style: {\n              color: \"white\",\n              fontSize: 20\n            },\n            children: \"Flip\"\n          })]\n        }), _jsxs(TouchableOpacity, {\n          style: {\n            alignItems: \"center\",\n            paddingLeft: 10,\n            paddingBottom: 10\n          },\n          onPress: function onPress() {\n            setFlash(flash === Camera.Constants.FlashMode.off ? Camera.Constants.FlashMode.on : Camera.Constants.FlashMode.off);\n          },\n          children: [_jsx(IonIcon, {\n            name: flash === Camera.Constants.FlashMode.off ? 'flash-off' : 'flash',\n            size: 30,\n            color: \"white\"\n          }), _jsx(Text, {\n            style: {\n              color: \"white\",\n              fontSize: 20\n            },\n            children: \"Flash\"\n          })]\n        })]\n      }), _jsx(Button, {\n        title: \"Take a picture\",\n        titleStyle: {\n          fontWeight: '500'\n        },\n        buttonStyle: {\n          backgroundColor: '#e92754',\n          borderColor: 'transparent',\n          borderWidth: 0,\n          height: 60,\n          color: \"#000\"\n        },\n        onPress: function _callee2() {\n          var photo, data, rawResponse, response;\n          return _regeneratorRuntime.async(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  setIsVisible(true);\n\n                  if (!cameraRef) {\n                    _context2.next = 16;\n                    break;\n                  }\n\n                  _context2.next = 4;\n                  return _regeneratorRuntime.awrap(cameraRef.takePictureAsync({\n                    quality: 0.1,\n                    base64: true,\n                    exif: true\n                  }));\n\n                case 4:\n                  photo = _context2.sent;\n                  console.log(\"Votre photo a bien été prise, elle possède une largeur de \" + photo.width + \"px\");\n                  setIsVisible(false);\n                  data = new FormData();\n                  data.append('avatar', {\n                    uri: photo.uri,\n                    type: 'image/jpeg',\n                    name: 'user_avatar.jpg'\n                  });\n                  _context2.next = 11;\n                  return _regeneratorRuntime.awrap(fetch('http://172.20.10.5:3000/upload', {\n                    method: 'POST',\n                    body: data\n                  }));\n\n                case 11:\n                  rawResponse = _context2.sent;\n                  _context2.next = 14;\n                  return _regeneratorRuntime.awrap(rawResponse.json());\n\n                case 14:\n                  response = _context2.sent;\n                  props.sendImageURL(response);\n\n                case 16:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        }\n      }), _jsx(Overlay, {\n        isVisible: isVisible,\n        overlayStyle: {\n          width: 175,\n          height: 50,\n          borderRadius: 15,\n          alignItems: 'center',\n          justifyContent: 'center',\n          shadowOpacity: 100\n        },\n        children: _jsx(Text, {\n          style: {\n            fontSize: 20\n          },\n          children: \"Taking picture...\"\n        })\n      })]\n    });\n  } else {\n    cameraDisplay = _jsx(View, {\n      style: {\n        flex: 1\n      }\n    });\n  }\n\n  return _jsx(View, {\n    style: {\n      flex: 1\n    },\n    children: cameraDisplay\n  });\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    sendImageURL: function sendImageURL(photo) {\n      dispatch({\n        type: \"addURL\",\n        photo: photo\n      });\n    }\n  };\n}\n\nexport default connect(null, mapDispatchToProps)(SnapScreen);","map":{"version":3,"names":["React","useState","useEffect","useRef","Camera","Button","Overlay","Input","IonIcon","useIsFocused","connect","SnapScreen","props","hasPermission","setHasPermission","Constants","Type","back","type","setType","FlashMode","off","flash","setFlash","isVisible","setIsVisible","cameraRef","isFocused","requestCameraPermissionsAsync","status","cameraDisplay","flex","ref","flexDirection","justifyContent","alignItems","paddingRight","paddingBottom","front","color","fontSize","paddingLeft","on","fontWeight","backgroundColor","borderColor","borderWidth","height","takePictureAsync","quality","base64","exif","photo","console","log","width","data","FormData","append","uri","name","fetch","method","body","rawResponse","json","response","sendImageURL","borderRadius","shadowOpacity","mapDispatchToProps","dispatch"],"sources":["/Users/jimmycabuy/Documents/jim/DIVERS/code/lacapsule/projet/8faceup/part3/frontend/screens/SnapScreen.js"],"sourcesContent":["import { View, Text, TouchableOpacity } from 'react-native'\nimport React, { useState, useEffect, useRef} from 'react';\nimport { Camera } from 'expo-camera';\nimport { Button, Overlay, Input } from 'react-native-elements'\nimport IonIcon from 'react-native-vector-icons/Ionicons';\nimport { useIsFocused } from '@react-navigation/native';\nimport { connect } from 'react-redux';\n\nfunction SnapScreen(props) {\n\nconst [hasPermission, setHasPermission] = useState(false);\nconst [type, setType] = useState(Camera.Constants.Type.back);\nconst [flash, setFlash] = useState(Camera.Constants.FlashMode.off);\nconst [isVisible, setIsVisible] = useState(false);\n\nvar cameraRef = useRef(null);\n\nconst isFocused = useIsFocused();\n\nuseEffect(() => {  \n    (async () => {\n        const { status } = await Camera.requestCameraPermissionsAsync();\n        setHasPermission(status === 'granted');\n    })();\n  }, []);\n\n  var cameraDisplay;\n  if(hasPermission && isFocused) {\n   cameraDisplay = \n   <Camera type={type} flashMode={flash} style={{ flex: 1 }} ref={ref => (cameraRef = ref)}>\n       <View style={{flex:1, flexDirection: 'row', justifyContent:'center', alignItems:'flex-end'}}>\n            <TouchableOpacity style={{alignItems:\"center\", paddingRight:10, paddingBottom:10}} onPress={() => {setType(type === Camera.Constants.Type.back ? Camera.Constants.Type.front : Camera.Constants.Type.back);}}>\n                <IonIcon name=\"camera-reverse\" size={30} color=\"white\"/>\n                <Text style={{color:\"white\", fontSize:20}}>Flip</Text>\n            </TouchableOpacity>\n            <TouchableOpacity style={{alignItems:\"center\", paddingLeft:10, paddingBottom:10}} onPress={() => {setFlash(flash === Camera.Constants.FlashMode.off ? Camera.Constants.FlashMode.on : Camera.Constants.FlashMode.off);}}>\n                <IonIcon name={flash === Camera.Constants.FlashMode.off ? 'flash-off' : 'flash'} size={30} color=\"white\"/>\n                <Text style={{color:\"white\", fontSize:20}}>Flash</Text>\n            </TouchableOpacity>\n       </View>\n       <Button\n       title=\"Take a picture\"\n       titleStyle={{ fontWeight: '500' }}\n       buttonStyle={{\n       backgroundColor: '#e92754',\n       borderColor: 'transparent',\n       borderWidth: 0,\n       height: 60,\n       color:\"#000\"\n       }}\n       onPress={async () => {\n        setIsVisible(true)\n           if(cameraRef){\n               let photo = await cameraRef.takePictureAsync(\n                   { quality: 0.1, base64: true, exif: true }\n               )\n               console.log(\"Votre photo a bien été prise, elle possède une largeur de \" + photo.width + \"px\");\n               setIsVisible(false);\n               \n               var data = new FormData();\n               \n               data.append('avatar', {\n                   uri: photo.uri,\n                   type: 'image/jpeg',\n                   name: 'user_avatar.jpg',\n                });\n                var rawResponse = await fetch('http://172.20.10.5:3000/upload', {\n                    method: 'POST',\n                    body: data\n                })\n                var response = await rawResponse.json()\n                // console.log(response);\n                props.sendImageURL(response)\n           }\n       }}\n       />\n       <Overlay isVisible={isVisible}\n        overlayStyle={{\n        width: 175,\n        height:50,\n        borderRadius: 15,\n        alignItems: 'center',\n        justifyContent: 'center',\n        shadowOpacity: 100,\n      }}\n      >\n      <Text style={{fontSize:20}}>Taking picture...</Text> \n      </Overlay>\n   </Camera>\n  } else {\n   cameraDisplay = <View style={{ flex: 1 }}></View>\n  }\n\n  return (\n<View style={{ flex: 1 }}>\n    {cameraDisplay}\n</View>\n  )\n}\n\nfunction mapDispatchToProps(dispatch){\n    return {\n      sendImageURL: function(photo){\n        dispatch ({type: \"addURL\", photo: photo})\n      }\n    }\n  }\n  export default connect(null, mapDispatchToProps)\n  (SnapScreen);"],"mappings":"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"},"metadata":{},"sourceType":"module"}